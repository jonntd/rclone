# rclone 115/123网盘测试脚本使用说明

## 📋 概述

本目录包含了完整的rclone 115网盘和123网盘双向传输测试工具集，用于验证秒传功能、性能基准测试和故障排除。

## 📁 文件清单

| 文件名 | 类型 | 用途 | 执行时间 |
|--------|------|------|----------|
| `rclone_115_123_双向传输测试文档.md` | 文档 | 详细测试文档和配置指南 | - |
| `test_115_123_bidirectional.sh` | 脚本 | 完整的双向传输测试套件 | 10-15分钟 |
| `quick_test_instant_upload.sh` | 脚本 | 快速秒传功能验证 | 2-3分钟 |
| `测试脚本使用说明.md` | 文档 | 本使用说明文档 | - |

## 🚀 快速开始

### 1. 环境准备

确保以下条件满足：

```bash
# 检查rclone可执行文件
ls -la ./rclone_115_instant

# 检查网盘配置
./rclone_115_instant config show | grep -E "\[115\]|\[123\]"

# 检查测试文件是否存在
./rclone_115_instant ls 123:test1/ | grep test_50mb_new.bin
./rclone_115_instant ls 123:test_instant_transfer/ | grep test_medium_file.bin
```

### 2. 快速验证秒传功能

**推荐首次使用**：

```bash
# 快速测试（2-3分钟）
./quick_test_instant_upload.sh

# 仅检查环境
./quick_test_instant_upload.sh --check-only

# 查看帮助
./quick_test_instant_upload.sh --help
```

**预期输出示例**：
```
=== rclone 115/123网盘秒传功能快速测试 ===

=== 环境检查 ===
✅ rclone可执行文件检查通过
✅ 网盘配置检查通过

=== 测试1: 123→115 小文件秒传 ===
📋 测试: 123→115 (50MB)
✅ 123→115 (50MB) - 秒传成功 (11秒)
  ✅ 符合预期：触发秒传
  📊 传输速度: 4.545 MiB/s

=== 测试结果统计 ===
总测试数: 4
成功测试: 4
失败测试: 0
成功率: 100%

✅ 🎉 所有测试通过！双向秒传功能正常工作
```

### 3. 完整测试套件

**用于详细验证和性能测试**：

```bash
# 完整测试（10-15分钟）
./test_115_123_bidirectional.sh

# 干运行模式（查看将要执行的测试）
./test_115_123_bidirectional.sh --dry-run

# 查看帮助
./test_115_123_bidirectional.sh --help
```

## ⚙️ 配置选项

### 环境变量

```bash
# 自定义rclone可执行文件路径
export RCLONE_BIN="/path/to/your/rclone"

# 自定义日志目录
export LOG_DIR="/custom/log/directory"

# 执行测试
./test_115_123_bidirectional.sh
```

### 测试文件配置

编辑脚本中的测试文件配置：

```bash
# 在 test_115_123_bidirectional.sh 中修改
declare -a TEST_FILES=(
    "small:test1/your_small_file.bin:50MB"
    "medium:test1/your_medium_file.bin:200MB"
    "large:test1/your_large_file.bin:1GB"
)
```

## 📊 测试结果解读

### 快速测试结果

```bash
# 成功的秒传测试
✅ 123→115 (50MB) - 秒传成功 (11秒)
  ✅ 符合预期：触发秒传
  📊 传输速度: 4.545 MiB/s

# 传统传输测试
📋 123→115 (16MB) - 传统传输 (29秒)
  ✅ 符合预期：传统传输
  📊 传输速度: 0.567 MiB/s
```

### 完整测试报告

完整测试会生成详细的Markdown报告：

```
/tmp/rclone_tests/test_results_20250706_011234.md
```

报告包含：
- 测试环境信息
- 每个测试的详细结果
- 性能基准对比
- 错误日志分析
- 建议和总结

## 🔧 故障排除

### 常见问题

#### 1. 文件不存在错误
```bash
❌ 源文件不存在: 123:test1/test_50mb_new.bin
```

**解决方案**：
```bash
# 检查文件是否存在
./rclone_115_instant ls 123:test1/

# 创建测试文件（如果需要）
dd if=/dev/zero of=/tmp/test_50mb.bin bs=1M count=50
./rclone_115_instant copy /tmp/test_50mb.bin 123:test1/test_50mb_new.bin
```

#### 2. 网盘配置错误
```bash
❌ 115网盘配置不存在
```

**解决方案**：
```bash
# 检查配置
./rclone_115_instant config show

# 重新配置网盘
./rclone_115_instant config
```

#### 3. 权限错误
```bash
❌ rclone可执行文件不存在或无执行权限
```

**解决方案**：
```bash
# 添加执行权限
chmod +x ./rclone_115_instant

# 检查文件
ls -la ./rclone_115_instant
```

#### 4. API限制错误
```bash
ERROR : 429 Too Many Requests
```

**解决方案**：
```bash
# 降低并发数，增加延迟
./rclone_115_instant copy SOURCE DEST \
  --transfers 2 \
  --checkers 4 \
  --pacer-min-sleep 1s
```

### 调试模式

启用详细调试：

```bash
# 修改脚本中的日志级别
--log-level DEBUG

# 或者手动执行调试命令
./rclone_115_instant copy SOURCE DEST \
  --log-level DEBUG \
  --log-file /tmp/debug.log \
  --dump headers
```

## 📈 性能优化建议

### 根据网络环境调整参数

#### 高速网络 (>100Mbps)
```bash
--transfers 8 \
--checkers 16 \
--buffer-size 32M \
--multi-thread-streams 4
```

#### 普通网络 (10-100Mbps)
```bash
--transfers 4 \
--checkers 8 \
--buffer-size 16M \
--multi-thread-streams 2
```

#### 慢速网络 (<10Mbps)
```bash
--transfers 2 \
--checkers 4 \
--buffer-size 8M \
--timeout 300s
```

### 秒传功能优化

1. **确保文件完整性**：传输前验证文件哈希
2. **合理控制并发**：秒传时使用较低并发避免API限制
3. **监控API配额**：注意QPS限制，适当增加延迟

## 📝 自定义测试

### 创建自定义测试脚本

```bash
#!/bin/bash

# 自定义测试示例
RCLONE_BIN="./rclone_115_instant"

# 测试特定文件
test_specific_file() {
    local source="$1"
    local dest="$2"
    
    echo "测试: $source → $dest"
    
    time $RCLONE_BIN copy "$source" "$dest" \
        --progress \
        --log-level INFO \
        --stats 1s
}

# 执行测试
test_specific_file "123:your_path/your_file.bin" "115:test_dest/"
```

### 批量测试脚本

```bash
#!/bin/bash

# 批量测试多个文件
declare -a FILES=(
    "file1.bin"
    "file2.bin" 
    "file3.bin"
)

for file in "${FILES[@]}"; do
    echo "=== 测试文件: $file ==="
    ./rclone_115_instant copy "123:source/$file" "115:dest/" \
        --progress --log-level INFO
    sleep 2
done
```

## 🎯 最佳实践

1. **测试前准备**：确保测试文件已存在于源网盘
2. **分步测试**：先运行快速测试，再运行完整测试
3. **日志保存**：保留测试日志用于问题排查
4. **定期验证**：定期运行测试确保功能正常
5. **性能监控**：关注传输速度和成功率变化

## 📞 技术支持

如遇到问题，请提供以下信息：

1. **错误信息**：完整的错误日志
2. **环境信息**：操作系统、rclone版本
3. **测试配置**：使用的参数和配置
4. **网络环境**：带宽、稳定性情况

---

*文档版本: v1.0*  
*最后更新: 2025-07-06*
